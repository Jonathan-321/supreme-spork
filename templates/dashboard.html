{% extends 'base.html' %}

{% block title %}AgriFinance - Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Farmer Dashboard</h2>
    <div>
        <span class="badge bg-info me-2">
            <i class="fas fa-user me-1"></i> Demo Account
        </span>
        <span class="badge bg-secondary">
            <i class="fas fa-map-marker-alt me-1"></i> Eastern Region, Ghana
        </span>
    </div>
</div>

<!-- Overview Cards - More streamlined UI based on the shared image -->
<div class="row mb-4">
    <div class="col-md-3 mb-3 mb-md-0">
        <div class="card dashboard-card">
            <div class="card-body text-center">
                <h5 class="text-primary mb-3">Credit Score</h5>
                <div class="score-circle d-flex justify-content-center align-items-center mx-auto">
                    <span class="fs-3 fw-bold">75</span>
                </div>
                <div class="mt-3">
                    <a href="#" class="btn btn-sm btn-outline-primary">View Details</a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3 mb-md-0">
        <div class="card dashboard-card">
            <div class="card-body text-center">
                <h5 class="text-success mb-3">Farms</h5>
                <div class="icon-container">
                    <i class="fas fa-tractor text-success fa-3x"></i>
                    <h2 class="mt-2">2</h2>
                </div>
                <div class="mt-3">
                    <a href="#" class="btn btn-sm btn-outline-success">View Farms</a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3 mb-md-0">
        <div class="card dashboard-card">
            <div class="card-body text-center">
                <h5 class="text-warning mb-3">Active Loans</h5>
                <div class="icon-container">
                    <i class="fas fa-hand-holding-usd text-warning fa-3x"></i>
                    <h2 class="mt-2">1</h2>
                </div>
                <div class="mt-3">
                    <a href="#" class="btn btn-sm btn-outline-warning">View Loans</a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card dashboard-card">
            <div class="card-body text-center">
                <h5 class="text-info mb-3">Climate Data</h5>
                <div class="icon-container">
                    <i class="fas fa-cloud-sun-rain text-info fa-3x"></i>
                    <h2 class="mt-2"><i class="fas fa-chart-line"></i></h2>
                </div>
                <div class="mt-3">
                    <a href="#" class="btn btn-sm btn-outline-info">View Data</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Active Loans Section -->
<div class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Active Loans</h4>
        <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
    </div>
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Loan ID</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Term</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>L-2025-001</td>
                    <td>$5,000</td>
                    <td><span class="badge bg-primary">Disbursed</span></td>
                    <td>12 months</td>
                    <td>
                        <a href="#" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-eye"></i>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="row">
    <!-- Eligible Loan Products -->
    <div class="col-md-6 mb-4">
        <div class="mb-3">
            <h4>Eligible Loan Products</h4>
        </div>
        <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h5 class="card-title">Seasonal Crop Loan</h5>
                        <p class="card-text">Short-term financing for seasonal crop production needs including seeds, fertilizers, and labor.</p>
                        <p class="text-muted mb-0">12% for 6-12 months</p>
                    </div>
                    <div class="text-end">
                        <div class="badge bg-success mb-2">Up to $10,000</div>
                        <div class="d-block">
                            <button class="btn btn-sm btn-success">Apply</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h5 class="card-title">Farm Equipment Loan</h5>
                        <p class="card-text">Medium-term financing for purchasing farm equipment and machinery.</p>
                        <p class="text-muted mb-0">15% for 24-36 months</p>
                    </div>
                    <div class="text-end">
                        <div class="badge bg-success mb-2">Up to $25,000</div>
                        <div class="d-block">
                            <button class="btn btn-sm btn-success">Apply</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Your Farms -->
    <div class="col-md-6 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>Your Farms</h4>
            <a href="#" class="btn btn-sm btn-outline-success">Details</a>
        </div>
        <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Riverside Farm</h5>
                    <span class="badge bg-success">5.2 ha</span>
                </div>
                <div class="mb-2 text-muted">
                    Main crop: Maize
                    <span class="ms-3"><i class="fas fa-tint text-info"></i> Irrigated</span>
                </div>
                <a href="#" class="btn btn-sm btn-outline-info">
                    <i class="fas fa-cloud-sun-rain me-1"></i> Climate Data
                </a>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Hilltop Farm</h5>
                    <span class="badge bg-success">3.8 ha</span>
                </div>
                <div class="mb-2 text-muted">
                    Main crop: Cassava
                </div>
                <a href="#" class="btn btn-sm btn-outline-info">
                    <i class="fas fa-cloud-sun-rain me-1"></i> Climate Data
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Climate Overview -->
<div class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Climate Overview</h4>
        <a href="#" class="btn btn-sm btn-outline-info">Details</a>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="alert alert-info mb-4" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                Climate data is being monitored for your region. Visit the Climate Dashboard for detailed information.
            </div>
            
            <div class="row align-items-center justify-content-around">
                <div class="col-md-3 text-center mb-3 mb-md-0">
                    <div class="climate-icon-container mb-2">
                        <i class="fas fa-temperature-high fa-2x text-danger"></i>
                    </div>
                    <h6>Temperature</h6>
                    <div class="climate-value">24Â°C</div>
                </div>
                <div class="col-md-3 text-center mb-3 mb-md-0">
                    <div class="climate-icon-container mb-2">
                        <i class="fas fa-cloud-rain fa-2x text-primary"></i>
                    </div>
                    <h6>Precipitation</h6>
                    <div class="climate-value">12mm</div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="climate-icon-container mb-2">
                        <i class="fas fa-seedling fa-2x text-success"></i>
                    </div>
                    <h6>NDVI</h6>
                    <div class="climate-value">0.68</div>
                </div>
                <div class="col-md-3 text-center">
                    <a href="#" class="btn btn-info">
                        <i class="fas fa-chart-line me-1"></i> View Climate Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .score-circle {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        color: white;
        position: relative;
        background: conic-gradient(
            #4caf50 calc(75 * 1%),
            #1e1e2f 0
        );
        mask: radial-gradient(transparent 55%, white 56%);
        -webkit-mask: radial-gradient(transparent 55%, white 56%);
    }
    
    .dashboard-card {
        height: 100%;
        border: none;
        transition: transform 0.2s ease-in-out;
    }
    
    .dashboard-card:hover {
        transform: translateY(-5px);
    }
    
    .icon-container {
        margin: 15px 0;
    }
    
    .climate-value {
        font-size: 1.5rem;
        font-weight: 500;
    }
    
    .climate-icon-container {
        background-color: rgba(255, 255, 255, 0.1);
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize the score circle
        const scoreCircles = document.querySelectorAll('.score-circle');
        
        scoreCircles.forEach(circle => {
            const scoreText = circle.textContent.trim();
            const score = parseInt(scoreText, 10);
            
            if (!isNaN(score)) {
                // Set the score color gradient dynamically
                let color = '#dc3545'; // Red for low scores
                
                if (score >= 80) {
                    color = '#198754'; // Green for high scores
                } else if (score >= 60) {
                    color = '#0dcaf0'; // Blue for medium-high scores
                } else if (score >= 40) {
                    color = '#ffc107'; // Yellow for medium scores
                }
                
                circle.style.background = `conic-gradient(
                    ${color} calc(${score} * 1%),
                    #1e1e2f 0
                )`;
            }
        });
    });
</script>
{% endblock %}